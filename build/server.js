!function(e){function r(t){if(n[t])return n[t].exports;var o=n[t]={exports:{},id:t,loaded:!1};return e[t].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}var n={};return r.m=e,r.c=n,r.p="",r(0)}([function(e,r,n){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}var o=n(1),u=t(o),i=n(2),s=t(i),a=n(3),c=t(a),l=n(4),f=t(l),d=n(5),v=t(d),p=n(6),g=t(p);n(7);var R=process.env.API_SERVER_PORT;R||(R=3006);var E=s.default.createProxyServer(),_="http://localhost:"+R,y=process.env.MAIN_SERVER_PORT;y||(y=3001);var m=(0,c.default)();m.use((0,g.default)("build/public/assets/favicon.ico")),m.use((0,f.default)()),m.use((0,v.default)("combined")),m.use(c.default.static("build/public")),m.all("/api/*",function(e,r){E.web(e,r,{target:_})}),m.use("/s3",n(10)({bucket:"socialnotsocial",headers:{"Access-Control-Allow-Origin":"*"}}));var h=u.default.createServer(m),x=process.env.PORT||y;h.listen(x),h.on("listening",function(e){e?console.log("Main Server ERROR on startup: "+e):console.log("Main Server listening on http://localhost:"+x+".")})},function(e,r){e.exports=require("http")},function(e,r){e.exports=require("http-proxy")},function(e,r){e.exports=require("express")},function(e,r){e.exports=require("helmet")},function(e,r){e.exports=require("morgan")},function(e,r){e.exports=require("serve-favicon")},function(e,r,n){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}var o=n(8),u=(t(o),n(9)),i=t(u);console.log("Environment: did NOT load environment variables from .env for production. This is not a problem if you define your environment variables outside of the file system as you should."),(0,i.default)(["REDIS_URL","DATABASE_URL","MAIN_SERVER_PORT","ACCOUNT_PEPPER_1","ACCOUNT_ENCRYPT_CURRENT_PEPPER","IDIER_WORKER_ID","TOKEN_PEPPER_1","TOKEN_ENCRYPT_CURRENT_PEPPER","SESSION_SECRET"])},function(e,r){e.exports=require("dotenv")},function(e,r){e.exports=require("require-environment-variables")},function(e,r,n){function t(e){return e&&"/"!=e[e.length-1]&&(e+="/"),e}function o(e){function r(e,r){var u={Bucket:n,Key:t(o(e))+e.params[0]},s=new i.S3(a);s.getSignedUrl("getObject",u,function(e,n){r.redirect(n)})}var n=e.bucket,o=e.getFileKeyDir||function(){return""};if(!n)throw new Error("S3_BUCKET is required.");var a={};e.region&&(a.region=e.region),e.signatureVersion&&(a.signatureVersion=e.signatureVersion);var c=s.Router();return c.get(/\/img\/(.*)/,function(e,n){return r(e,n)}),c.get(/\/uploads\/(.*)/,function(e,n){return r(e,n)}),c.get("/sign",function(r,s){var c=u.v4()+"_"+r.query.objectName,l=r.query.contentType,f=t(o(r))+c;e.headers&&s.set(e.headers);var d=new i.S3(a),v={Bucket:n,Key:f,Expires:60,ContentType:l,ACL:e.ACL||"private"};d.getSignedUrl("putObject",v,function(e,r){return e?(console.log(e),s.send(500,"Cannot create S3 signed URL")):void s.json({signedUrl:r,publicUrl:"/s3/uploads/"+c,filename:c})})}),c}var u=n(11),i=n(13),s=n(3);e.exports=o},function(e,r,n){var t;!function(o){"use strict";function u(){var e=o.crypto||o.msCrypto;if(!f&&e&&e.getRandomValues)try{var r=new Uint8Array(16);p=f=function(){return e.getRandomValues(r),r},f()}catch(e){}if(!f){var n=new Array(16);d=f=function(){for(var e,r=0;r<16;r++)0===(3&r)&&(e=4294967296*Math.random()),n[r]=e>>>((3&r)<<3)&255;return n},"undefined"!=typeof console&&console.warn&&console.warn("[SECURITY] node-uuid: crypto not usable, falling back to insecure Math.random()")}}function i(){try{var e=n(12).randomBytes;v=f=e&&function(){return e(16)},f()}catch(e){}}function s(e,r,n){var t=r&&n||0,o=0;for(r=r||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){o<16&&(r[t+o++]=E[e])});o<16;)r[t+o++]=0;return r}function a(e,r){var n=r||0,t=R;return t[e[n++]]+t[e[n++]]+t[e[n++]]+t[e[n++]]+"-"+t[e[n++]]+t[e[n++]]+"-"+t[e[n++]]+t[e[n++]]+"-"+t[e[n++]]+t[e[n++]]+"-"+t[e[n++]]+t[e[n++]]+t[e[n++]]+t[e[n++]]+t[e[n++]]+t[e[n++]]}function c(e,r,n){var t=r&&n||0,o=r||[];e=e||{};var u=null!=e.clockseq?e.clockseq:h,i=null!=e.msecs?e.msecs:(new Date).getTime(),s=null!=e.nsecs?e.nsecs:w+1,c=i-x+(s-w)/1e4;if(c<0&&null==e.clockseq&&(u=u+1&16383),(c<0||i>x)&&null==e.nsecs&&(s=0),s>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");x=i,w=s,h=u,i+=122192928e5;var l=(1e4*(268435455&i)+s)%4294967296;o[t++]=l>>>24&255,o[t++]=l>>>16&255,o[t++]=l>>>8&255,o[t++]=255&l;var f=i/4294967296*1e4&268435455;o[t++]=f>>>8&255,o[t++]=255&f,o[t++]=f>>>24&15|16,o[t++]=f>>>16&255,o[t++]=u>>>8|128,o[t++]=255&u;for(var d=e.node||m,v=0;v<6;v++)o[t+v]=d[v];return r?r:a(o)}function l(e,r,n){var t=r&&n||0;"string"==typeof e&&(r="binary"===e?new g(16):null,e=null),e=e||{};var o=e.random||(e.rng||f)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,r)for(var u=0;u<16;u++)r[t+u]=o[u];return r||a(o)}var f,d,v,p;o?u():i();for(var g="function"==typeof Buffer?Buffer:Array,R=[],E={},_=0;_<256;_++)R[_]=(_+256).toString(16).substr(1),E[R[_]]=_;var y=f(),m=[1|y[0],y[1],y[2],y[3],y[4],y[5]],h=16383&(y[6]<<8|y[7]),x=0,w=0,S=l;S.v1=c,S.v4=l,S.parse=s,S.unparse=a,S.BufferClass=g,S._rng=f,S._mathRNG=d,S._nodeRNG=v,S._whatwgRNG=p,"undefined"!=typeof e&&e.exports?e.exports=S:(t=function(){return S}.call(r,n,r,e),!(void 0!==t&&(e.exports=t)))}("undefined"!=typeof window?window:null)},function(e,r){e.exports=require("crypto")},function(e,r){e.exports=require("aws-sdk")}]);
//# sourceMappingURL=server.js.map